name: üöÄ –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–ª–∏–∑–∞

on:
  push:
    tags:
      - 'v*'

permissions:
  contents: write

jobs:
  release:
    name: üì¶ –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–ª–∏–∑–∞
    runs-on: ubuntu-latest
    
    steps:
      - name: üì• Checkout
        uses: actions/checkout@v4
        
      - name: üìã –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ–≥–µ
        id: tag_info
        run: |
          echo "tag=${GITHUB_REF#refs/tags/}" >> $GITHUB_OUTPUT
          echo "date=$(date +'%Y-%m-%d')" >> $GITHUB_OUTPUT
          
      - name: üì¶ –°–æ–∑–¥–∞–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞
        run: |
          mkdir -p release
          zip -r release/instruct-pix2pix-studio-${{ steps.tag_info.outputs.tag }}.zip \
            app.py \
            src/ \
            requirements.txt \
            requirements-windows.txt \
            setup.bat \
            run.bat \
            README.md \
            LICENSE \
            outputs/.gitkeep \
            -x "*.pyc" -x "__pycache__/*"
            
      - name: üéâ –°–æ–∑–¥–∞–Ω–∏–µ GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          name: "üé® InstructPix2Pix Studio ${{ steps.tag_info.outputs.tag }}"
          body: |
            ## üé® InstructPix2Pix Studio ${{ steps.tag_info.outputs.tag }}
            
            **–î–∞—Ç–∞ —Ä–µ–ª–∏–∑–∞:** ${{ steps.tag_info.outputs.date }}
            
            ### üì• –£—Å—Ç–∞–Ω–æ–≤–∫–∞
            
            1. –°–∫–∞—á–∞–π –∞—Ä—Ö–∏–≤ –Ω–∏–∂–µ
            2. –†–∞—Å–ø–∞–∫—É–π –≤ –ª—é–±—É—é –ø–∞–ø–∫—É
            3. –ó–∞–ø—É—Å—Ç–∏ `setup.bat` –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
            4. –ó–∞–ø—É—Å—Ç–∏ `run.bat` –¥–ª—è —Å—Ç–∞—Ä—Ç–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            5. –û—Ç–∫—Ä–æ–π http://localhost:7860 –≤ –±—Ä–∞—É–∑–µ—Ä–µ
            
            ### üíª –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
            
            - Windows 10/11
            - Python 3.10+
            - AMD RX 5000+ –∏–ª–∏ NVIDIA GTX 1060+ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
            - 16 –ì–ë RAM
            - 10 –ì–ë —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
            
            ### üìù –ò–∑–º–µ–Ω–µ–Ω–∏—è
            
            –°–º–æ—Ç—Ä–∏ [CHANGELOG](https://github.com/randomu3/instruct-pix2pix-studio/commits/${{ steps.tag_info.outputs.tag }})
            
          files: |
            release/instruct-pix2pix-studio-${{ steps.tag_info.outputs.tag }}.zip
          draft: false
          prerelease: false
          generate_release_notes: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
